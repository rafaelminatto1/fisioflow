#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-commit hook simplificado para FisioFlow
echo "üîç Executando verifica√ß√µes pre-commit..."

# 1. Lint-staged (formata√ß√£o e lint b√°sico)
echo "üßπ Executando lint-staged..."
npm.cmd run pre-commit

# 2. Verificar se h√° secrets/keys expostos (apenas em arquivos de c√≥digo)
echo "üîê Verificando por secrets expostos..."
if grep -r -i --exclude-dir=node_modules --exclude-dir=.git --exclude-dir=dist --exclude-dir=build \
  --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" --include="*.env*" \
  -E "(api_key|secret|password)\s*=\s*['\"][a-zA-Z0-9]{16,}" . && \
  ! grep -q "mock-token" . && \
  ! grep -q "SMS_TOKEN = 'sms_token'" . ; then
  echo "‚ùå Poss√≠veis secrets detectados! Remova antes do commit."
  exit 1
fi

echo "‚úÖ Verifica√ß√µes b√°sicas conclu√≠das!"