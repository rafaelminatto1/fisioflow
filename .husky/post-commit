#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Post-commit hook para FisioFlow
echo "ğŸ‰ Commit realizado com sucesso!"

# 1. Mostrar estatÃ­sticas do commit
echo "ğŸ“Š EstatÃ­sticas do commit:"
git show --stat HEAD

# 2. Verificar se Ã© um commit de feature
commit_message=$(git log -1 --pretty=%B)
if echo "$commit_message" | grep -q "^feat"; then
  echo "ğŸš€ Nova feature detectada!"
  echo "ğŸ’¡ Considere:"
  echo "   - Atualizar documentaÃ§Ã£o"
  echo "   - Adicionar testes se necessÃ¡rio"
  echo "   - Verificar se precisa de migration"
fi

# 3. Verificar se Ã© um commit de fix
if echo "$commit_message" | grep -q "^fix"; then
  echo "ğŸ”§ Bug fix detectado!"
  echo "ğŸ’¡ Considere:"
  echo "   - Adicionar teste de regressÃ£o"
  echo "   - Atualizar CHANGELOG.md"
  echo "   - Verificar se afeta outras partes do sistema"
fi

# 4. Sugerir prÃ³ximos passos baseado no branch
current_branch=$(git branch --show-current)
case $current_branch in
  "main"|"master")
    echo "ğŸŒŸ Commit na branch principal!"
    echo "ğŸ’¡ PrÃ³ximos passos sugeridos:"
    echo "   - Verificar se CI/CD passou"
    echo "   - Considerar criar tag de release"
    echo "   - Atualizar documentaÃ§Ã£o de produÃ§Ã£o"
    ;;
  "develop"|"dev")
    echo "ğŸ”„ Commit na branch de desenvolvimento!"
    echo "ğŸ’¡ PrÃ³ximos passos sugeridos:"
    echo "   - Testar integraÃ§Ã£o com outras features"
    echo "   - Preparar para merge na main"
    ;;
  feature/*)
    echo "âœ¨ Commit em feature branch!"
    echo "ğŸ’¡ PrÃ³ximos passos sugeridos:"
    echo "   - Continuar desenvolvimento"
    echo "   - Preparar para code review"
    echo "   - Testar localmente"
    ;;
  hotfix/*)
    echo "ğŸš¨ Commit em hotfix branch!"
    echo "ğŸ’¡ PrÃ³ximos passos sugeridos:"
    echo "   - Testar urgentemente"
    echo "   - Preparar para deploy rÃ¡pido"
    echo "   - Documentar o problema resolvido"
    ;;
esac

# 5. Verificar se hÃ¡ arquivos nÃ£o commitados
untracked=$(git ls-files --others --exclude-standard)
if [ -n "$untracked" ]; then
  echo "ğŸ“ Arquivos nÃ£o rastreados encontrados:"
  echo "$untracked" | head -5
  if [ $(echo "$untracked" | wc -l) -gt 5 ]; then
    echo "   ... e mais $(( $(echo "$untracked" | wc -l) - 5 )) arquivos"
  fi
  echo "ğŸ’¡ Use 'git add .' para adicionar ou atualize .gitignore"
fi

# 6. Mostrar prÃ³ximo commit hash para referÃªncia
echo "ğŸ”— Hash do commit: $(git rev-parse --short HEAD)"
echo "ğŸ“‹ Para referenciar: git show $(git rev-parse --short HEAD)"

echo "âœ¨ Happy coding! ğŸš€"